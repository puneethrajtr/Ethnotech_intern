<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Booking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2.5rem;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            color: #aaa;
            margin-top: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-top: 20px;
        }

        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .card h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ddd;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.15);
            color: #fff;
            font-size: 1rem;
        }

        .form-group input::placeholder {
            color: #888;
        }

        .form-group select option {
            background: #16213e;
            color: #fff;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255,215,0,0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: #fff;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .result-success {
            background: rgba(46, 204, 113, 0.3);
            border: 1px solid #2ecc71;
        }

        .result-error {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
        }

        .taxi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .taxi-card {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .taxi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .taxi-id {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
        }

        .taxi-earnings {
            background: #2ecc71;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .booking-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .booking-item {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .booking-item:last-child {
            margin-bottom: 0;
        }

        .booking-route {
            font-weight: 600;
            color: #ffd700;
            font-size: 1rem;
        }

        .booking-details {
            color: #aaa;
            margin-top: 5px;
        }

        .no-bookings {
            color: #888;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .route-map {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .point {
            width: 40px;
            height: 40px;
            background: #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1a1a2e;
            position: relative;
        }

        .point::after {
            content: '';
            position: absolute;
            right: -100%;
            width: 100%;
            height: 3px;
            background: #444;
        }

        .point:last-child::after {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöñ Taxi Booking System</h1>
            <p>Book your ride instantly ‚Ä¢ Points A to F ‚Ä¢ 15km between stops</p>
        </header>

        <!-- Route Map -->
        <div class="card">
            <div class="route-map">
                <div class="point">A</div>
                <div class="point">B</div>
                <div class="point">C</div>
                <div class="point">D</div>
                <div class="point">E</div>
                <div class="point">F</div>
            </div>
        </div>

        <div class="main-content">
            <!-- Booking Form -->
            <div class="card">
                <h2>üìã Book a Taxi</h2>
                <form id="bookingForm">
                    <div class="form-group">
                        <label for="customerId">Customer ID</label>
                        <input type="number" id="customerId" placeholder="Enter customer ID" required min="1">
                    </div>
                    <div class="form-group">
                        <label for="pickupPoint">Pickup Point</label>
                        <select id="pickupPoint" required>
                            <option value="">Select pickup point</option>
                            <option value="A">Point A</option>
                            <option value="B">Point B</option>
                            <option value="C">Point C</option>
                            <option value="D">Point D</option>
                            <option value="E">Point E</option>
                            <option value="F">Point F</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dropPoint">Drop Point</label>
                        <select id="dropPoint" required>
                            <option value="">Select drop point</option>
                            <option value="A">Point A</option>
                            <option value="B">Point B</option>
                            <option value="C">Point C</option>
                            <option value="D">Point D</option>
                            <option value="E">Point E</option>
                            <option value="F">Point F</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pickupTime">Pickup Time (Hour)</label>
                        <input type="number" id="pickupTime" placeholder="e.g., 9, 10, 12" required min="0">
                    </div>
                    <button type="submit" class="btn btn-primary">Book Taxi</button>
                    <button type="button" class="btn btn-secondary" onclick="resetSystem()">Re-Book</button>
                </form>

                <div id="bookingResult" class="result-box"></div>
            </div>

            <!-- Taxi Status -->
            <div class="card">
                <h2>üöï Taxi Fleet Status</h2>
                <div id="taxiList" class="taxi-grid">
                    <div class="loading">Loading taxis...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API base URL
        const API_URL = '';

        // Load taxis on page load
        document.addEventListener('DOMContentLoaded', loadTaxis);

        // Handle booking form submission
        document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const bookingData = {
                customer_id: parseInt(document.getElementById('customerId').value),
                pickup_point: document.getElementById('pickupPoint').value,
                drop_point: document.getElementById('dropPoint').value,
                pickup_time: parseInt(document.getElementById('pickupTime').value)
            };

            try {
                const response = await fetch(`${API_URL}/book`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();
                showResult(result);
                loadTaxis(); // Refresh taxi list
            } catch (error) {
                showResult({ status: 'error', message: 'Failed to connect to server' });
            }
        });

        // Load and display all taxis
        async function loadTaxis() {
            try {
                const response = await fetch(`${API_URL}/taxis`);
                const taxis = await response.json();
                displayTaxis(taxis);
            } catch (error) {
                document.getElementById('taxiList').innerHTML = 
                    '<div class="loading">Failed to load taxis</div>';
            }
        }

        // Display taxis in the grid
        function displayTaxis(taxis) {
            const container = document.getElementById('taxiList');
            
            if (taxis.length === 0) {
                container.innerHTML = '<div class="loading">No taxis available</div>';
                return;
            }

            container.innerHTML = taxis.map(taxi => `
                <div class="taxi-card">
                    <div class="taxi-header">
                        <span class="taxi-id">Taxi #${taxi.taxi_id}</span>
                        <span class="taxi-earnings">‚Çπ${taxi.total_earnings}</span>
                    </div>
                    <div class="booking-list">
                        ${taxi.bookings.length > 0 ? 
                            taxi.bookings.map(b => `
                                <div class="booking-item">
                                    <div class="booking-route">Booking #${b.booking_id} | ${b.from} ‚Üí ${b.to}</div>
                                    <div class="booking-details">
                                        Customer: ${b.customer_id} | 
                                        Time: ${b.pickup_time}:00 - ${b.drop_time}:00 | 
                                        Fare: ‚Çπ${b.amount}
                                    </div>
                                </div>
                            `).join('') :
                            '<div class="no-bookings">No bookings yet</div>'
                        }
                    </div>
                </div>
            `).join('');
        }

        // Show booking result
        function showResult(result) {
            const resultBox = document.getElementById('bookingResult');
            resultBox.style.display = 'block';

            if (result.status === 'success') {
                resultBox.className = 'result-box result-success';
                resultBox.innerHTML = `
                    <strong>‚úÖ Booking Confirmed!</strong><br>
                    Booking ID: #${result.booking_id}<br>
                    Taxi #${result.taxi_id} assigned<br>
                    Route: ${result.pickup_point} ‚Üí ${result.drop_point}<br>
                    Pickup Time: ${result.pickup_time}:00<br>
                    Drop Time: ${result.drop_time}:00<br>
                    Fare: ‚Çπ${result.amount}
                `;
            } else {
                resultBox.className = 'result-box result-error';
                resultBox.innerHTML = `
                    <strong>‚ùå ${result.status === 'rejected' ? 'Booking Rejected' : 'Error'}</strong><br>
                    ${result.message}
                `;
            }

            // Auto-hide after 5 seconds
            setTimeout(() => {
                resultBox.style.display = 'none';
            }, 5000);
        }

        // Reset the system
        async function resetSystem() {
            if (!confirm('Are you sure you want to reset all taxis and bookings?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/reset`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                if (result.status === 'success') {
                    showResult({ status: 'success', taxi_id: '-', drop_time: '-', amount: 'System Reset!' });
                    document.getElementById('bookingResult').innerHTML = '<strong>‚úÖ System Reset Successfully!</strong>';
                    loadTaxis();
                }
            } catch (error) {
                showResult({ status: 'error', message: 'Failed to reset system' });
            }
        }
    </script>
</body>
</html>
